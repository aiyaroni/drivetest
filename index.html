<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>×ª×™××•×¨×™×” GO â€“ ××ª×¨ ×œ×™××•×“ (UX ×××•×§×“ ×•××™× ×™××œ×™×¡×˜×™)</title>
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Assistant','system-ui','-apple-system','Segoe UI','Roboto','Noto Sans Hebrew','Helvetica','Arial','sans-serif']
          },
          colors: {
            brand: {
              primary: '#6A4C93',
              primaryLight: '#8B5FBF',
              primaryIndigo: '#7B68EE',
              action: '#2563EB',
              gold: '#FFD700',
              amber: '#F59E0B',
              success: '#16A34A',
              error: '#DC2626'
            }
          },
          boxShadow: {
            card: '0 10px 30px rgba(0,0,0,0.08)',
          },
          keyframes: {
            fadeInUp: {
              '0%': { opacity: 0, transform: 'translateY(18px)' },
              '100%': { opacity: 1, transform: 'translateY(0)' }
            },
            floaty: {
              '0%,100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-6px)' }
            }
          },
          animation: {
            'fade-in-up': 'fadeInUp 220ms ease-out both',
            'floaty': 'floaty 4s ease-in-out infinite'
          }
        }
      }
    }
  </script>
  <style>
    :focus-visible { outline: 3px solid #6A4C93; outline-offset: 2px; }
    .hero-gradient { background: linear-gradient(135deg, #8B5FBF 0%, #6A4C93 50%, #7B68EE 100%); }
    .btn-primary { background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: #333; }
    .btn-secondary { background: linear-gradient(135deg, #4299E1 0%, #3182CE 100%); color: #fff; }
    .section-soft { background: linear-gradient(135deg, #F7FAFC 0%, #EDF2F7 100%); }
    /* ××¦×‘ ×¤×•×§×•×¡: ××¡×ª×™×¨ ×¤×™×ª×•×—×™× ×•× ×™×•×•×˜ ×œ×œ××™×“×” ××œ××” */
    body.focus-mode header, body.focus-mode footer { display: none; }
    body.focus-mode .container { max-width: 68rem; }

    /* ×¨×™×•×•×œ-××•×Ÿ-×¡×§ë¡¤ */
    .reveal { opacity: 0; transform: translateY(18px); transition: opacity .22s ease, transform .22s ease; }
    .reveal.in-view { opacity: 1; transform: translateY(0); }

    @media (prefers-reduced-motion: reduce) {
      .reveal { transition: none; transform: none; }
      [class*="animate-"] { animation: none !important; }
    }
  </style>
</head>
<body class="min-h-screen bg-slate-50 font-sans text-slate-900">
  <!-- Hero -->
  <section class="hero-gradient min-h-[64vh] md:min-h-[72vh] relative flex items-center justify-center text-center px-4 pt-24 pb-16">
    <div class="absolute inset-0 pointer-events-none opacity-15">
      <div class="absolute -top-10 -right-10 w-40 h-40 rounded-full bg-white/25 blur-2xl animate-floaty"></div>
      <div class="absolute bottom-10 left-10 w-52 h-52 rounded-full bg-white/10 blur-3xl animate-floaty" style="animation-delay:.8s"></div>
    </div>
    <div class="relative z-10 max-w-3xl space-y-6">
      <h1 class="text-5xl md:text-7xl font-bold leading-tight text-white drop-shadow">×ª×™××•×¨×™×”&nbsp;GO</h1>
      <p class="text-white/90 text-lg md:text-xl">×œ××™×“×” ×××•×§×“×ª, ××‘×—×Ÿ ××“×•××” × ×××Ÿ ×œ××¦×™××•×ª, ×•×—×–×¨×ª×™×•×ª ×—×›××” ×¢×œ ×˜×¢×•×™×•×ª. ××™× ×™××œ×™, ××”×™×¨, ××“×•×™×§.</p>
      <div class="flex flex-wrap items-center justify-center gap-3 md:gap-4">
        <button id="hero-start-study" class="btn-primary px-6 py-3 rounded-full font-bold shadow hover:translate-y-[-2px] active:translate-y-[0] transition">×”×ª×—×œ/×™ ×œ××™×“×” ×™×•××™×ª</button>
        <button id="hero-start-exam" class="btn-secondary px-6 py-3 rounded-full font-bold shadow hover:translate-y-[-2px] active:translate-y-[0] transition">××‘×—×Ÿ ××“×•××”</button>
      </div>
    </div>
  </section>

  <!-- Header -->
  <header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-slate-200">
    <div class="container max-w-5xl mx-auto px-4 py-3 flex items-center gap-3">
      <div class="h-10 w-10 grid place-items-center rounded-2xl text-white text-lg" style="background: linear-gradient(135deg, #8B5FBF 0%, #6A4C93 50%, #7B68EE 100%);">ğŸš—</div>
      <div class="text-xl font-bold">×ª×™××•×¨×™×” GO</div>
      <div class="ms-auto flex items-center gap-2">
        <button id="btn-theme" class="px-3 py-1.5 text-sm rounded-xl border border-slate-300 bg-white/70 hover:bg-white transition" title="×”×—×œ×¤×ª ××¦×‘ ×ª×¦×•×’×”">××¦×‘ ×‘×”×™×¨</button>
      </div>
    </div>
    <nav class="container max-w-5xl mx-auto px-4 pb-3">
      <div class="grid grid-cols-2 sm:grid-cols-5 gap-2">
        <button data-view="home" class="tab-btn px-3 py-2 rounded-2xl bg-slate-900 text-white">×‘×™×ª</button>
        <button data-view="study" class="tab-btn px-3 py-2 rounded-2xl bg-white border border-slate-200">×œ××™×“×”</button>
        <button data-view="exam" class="tab-btn px-3 py-2 rounded-2xl bg-white border border-slate-200">××‘×—×Ÿ ××“×•××”</button>
        <button data-view="signs" class="tab-btn px-3 py-2 rounded-2xl bg-white border border-slate-200">×ª××¨×•×¨×™×</button>
        <button data-view="profile" class="tab-btn px-3 py-2 rounded-2xl bg-white border border-slate-200">×¤×¨×•×¤×™×œ</button>
      </div>
    </nav>
  </header>

  <!-- Toast (aria-live) -->
  <div id="toast" class="fixed top-3 left-3 sm:left-auto sm:right-3 z-50 hidden" aria-live="polite" role="status"></div>

  <main class="container max-w-5xl mx-auto px-4 py-10 space-y-10">
    <!-- HOME -->
    <section id="view-home" class="view grid md:grid-cols-2 gap-4">
      <div class="p-5 bg-white rounded-2xl shadow-card border border-slate-100 reveal">
        <h2 class="text-lg font-semibold mb-1">× ×ª×—×™×œ ××™×“ ğŸ‘‹</h2>
        <p class="text-slate-600 mb-4">×¡×©×Ÿ ×§×¦×¨ ×©×œ 5 ×©××œ×•×ª ×‘×™×•×, ×—×–×¨×” ×××•×§×“×ª ×¢×œ ×˜×¢×•×™×•×ª, ×•×‘×¡×•×£ ×¡×™××•×œ×¦×™×” ×××™×ª×™×ª.</p>
        <div class="flex flex-wrap gap-2">
          <button id="cta-start-daily" class="px-4 py-2 rounded-2xl text-white" style="background: linear-gradient(135deg, #8B5FBF 0%, #6A4C93 50%, #7B68EE 100%);">×”×ª×—×œ/×™ ×œ××™×“×” ×™×•××™×ª</button>
          <button id="cta-start-exam" class="px-4 py-2 rounded-2xl btn-primary">×”×ª×—×œ/×™ ××‘×—×Ÿ ××“×•××”</button>
        </div>
      </div>
      <div class="p-5 bg-white rounded-2xl shadow-card border border-slate-100 reveal">
        <h3 class="font-semibold mb-2">×”×ª×§×“××•×ª</h3>
        <div class="flex items-end gap-6">
          <div>
            <div class="text-3xl font-bold" id="stat-correct-rate">0%</div>
            <div class="text-slate-500 text-sm">×“×™×•×§ ×××•×¦×¢</div>
          </div>
          <div>
            <div class="text-3xl font-bold" id="stat-answered">0</div>
            <div class="text-slate-500 text-sm">×©××œ×•×ª ×©× ×¢× ×•</div>
          </div>
          <div>
            <div class="text-3xl font-bold" id="stat-streak">0ğŸ”¥</div>
            <div class="text-slate-500 text-sm">×¨×¦×£ ×™××™×</div>
          </div>
        </div>
      </div>
      <div class="md:col-span-2 rounded-2xl p-6 section-soft border border-slate-200 reveal">
        <h3 class="text-slate-800 text-xl font-bold mb-2">××¦×‘ ×××•×§×“</h3>
        <p class="text-slate-600">×‘×–××Ÿ ×œ××™×“×” ×”×××©×§ × ×›× ×¡ ×œÖ¾Focus Mode: ×¤×—×•×ª ×”×¡×—×•×ª, ××§×©×™ ×§×™×¦×•×¨, ×•×§×¦×‘ ×˜×‘×¢×™. ××¤×©×¨ ×œ×¦××ª ×‘×›×œ ×¨×’×¢.</p>
      </div>
    </section>

    <!-- STUDY (Focus Mode) -->
    <section id="view-study" class="view hidden">
      <div class="p-5 bg-white rounded-2xl shadow-card border border-slate-100 reveal">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold">×œ××™×“×” ×™×•××™×ª â€“ 5 ×©××œ×•×ª</h2>
          <div class="flex items-center gap-3 text-sm text-slate-600">
            <span class="hidden md:inline">×§×™×¦×•×¨×™ ××§×œ×“×ª: 1â€“4 ×ª×©×•×‘×”, N ×”×‘×, P ×”×§×•×“×, K ×“×œ×’</span>
            <div class="w-40 h-2 rounded-full bg-slate-200 overflow-hidden">
              <div id="study-progress" class="h-full" style="background: linear-gradient(135deg, #8B5FBF 0%, #6A4C93 50%, #7B68EE 100%); width:0%"></div>
            </div>
          </div>
        </div>
        <div id="study-card" class="space-y-3"></div>
        <div class="mt-4 flex items-center justify-between">
          <button id="study-skip" class="px-3 py-1.5 rounded-xl border">×“×œ×’</button>
          <button id="study-exit" class="px-3 py-1.5 rounded-xl border">×™×¦×™××” ×××¦×‘ ×××•×§×“</button>
        </div>
      </div>
    </section>

    <!-- EXAM -->
    <section id="view-exam" class="view hidden">
      <div class="p-5 bg-white rounded-2xl shadow-card border border-slate-100 space-y-4 reveal">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">××‘×—×Ÿ ××“×•××”</h2>
          <div class="flex items-center gap-3">
            <div class="text-slate-600" aria-live="polite" role="status">â±ï¸ ×–××Ÿ × ×•×ª×¨: <span id="exam-timer">â€”</span></div>
            <button id="btn-start-exam" class="px-3 py-1.5 rounded-xl btn-secondary">×”×ª×—×œ ××‘×—×Ÿ (30 ×©××œ×•×ª)</button>
          </div>
        </div>
        <div id="exam-area" class="hidden">
          <div class="flex items-center justify-between">
            <div id="exam-question" class="text-lg font-medium"></div>
            <button id="exam-mark" class="px-3 py-1.5 rounded-xl border" title="×¡××Ÿ ×œ×‘×“×™×§×” (M)">×¡××Ÿ ×œ×‘×“×™×§×”</button>
          </div>
          <div id="exam-options" class="mt-3 grid gap-2"></div>
          <div class="flex items-center justify-between mt-4">
            <button id="exam-prev" class="px-3 py-1.5 rounded-xl border">×”×§×•×“× (P)</button>
            <div class="text-sm text-slate-600"><span id="exam-index">1</span>/<span id="exam-total">30</span></div>
            <button id="exam-next" class="px-3 py-1.5 rounded-xl border">×”×‘× (N)</button>
          </div>
          <!-- ××¤×ª ×©××œ×•×ª -->
          <div id="exam-map" class="mt-4 grid grid-cols-10 sm:grid-cols-15 gap-1"></div>
          <div class="flex items-center gap-2 mt-4">
            <button id="exam-submit" class="px-4 py-2 rounded-2xl btn-primary">×¡×™×™× ××‘×—×Ÿ (S)</button>
            <button id="exam-cancel" class="px-3 py-1.5 rounded-xl border">×‘×™×˜×•×œ</button>
          </div>
        </div>
        <div id="exam-result" class="hidden"></div>
      </div>
    </section>

    <!-- SIGNS -->
    <section id="view-signs" class="view hidden">
      <div class="p-5 bg-white rounded-2xl shadow-card border border-slate-100 reveal">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold">×›×¨×˜×™×¡×™×•×ª ×ª××¨×•×¨×™×</h2>
          <div class="text-sm text-slate-600">×¡××Ÿ/×™ ×× ×–×›×•×¨, × ×ª×¨×’×œ ×©×•×‘ ××ª ×”×œ×Ö¾×–×›×•×¨×™×</div>
        </div>
        <div id="sign-card" class="space-y-3"></div>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="view-profile" class="view hidden">
      <div class="p-5 bg-white rounded-2xl shadow-card border border-slate-100 space-y-4 reveal">
        <h2 class="text-lg font-semibold">×¤×¨×•×¤×™×œ ×•×”×ª×§×“××•×ª</h2>
        <div class="grid sm:grid-cols-3 gap-4">
          <div class="p-4 rounded-2xl border bg-slate-50">
            <div class="text-slate-500 text-sm">×“×™×•×§ ×××•×¦×¢</div>
            <div class="text-2xl font-bold" id="pf-accuracy">0%</div>
          </div>
          <div class="p-4 rounded-2xl border bg-slate-50">
            <div class="text-slate-500 text-sm">×©××œ×•×ª ×©× ×¢× ×•</div>
            <div class="text-2xl font-bold" id="pf-answered">0</div>
          </div>
          <div class="p-4 rounded-2xl border bg-slate-50">
            <div class="text-slate-500 text-sm">×¨×¦×£ ×™××™×</div>
            <div class="text-2xl font-bold" id="pf-streak">0ğŸ”¥</div>
          </div>
        </div>
        <div>
          <h3 class="font-semibold mb-2">×“×™×•×§ ×œ×¤×™ × ×•×©×</h3>
          <div id="topic-stats" class="space-y-2"></div>
        </div>
      </div>
    </section>
  </main>

  <footer class="container max-w-5xl mx-auto px-4 pb-10 text-center text-slate-500 text-sm reveal">
    × ×‘× ×” ×›Ö¾MVP ×—×“Ö¾×¢××•×“×™ â€¢ ×ª×™××•×¨×™×” GO Â©
  </footer>

  <script>
    // ====== × ×ª×•× ×™ ×“××• ======
    const QUESTIONS = [
      {id:1, topic:'×—×•×§×™ ×ª× ×•×¢×”', q:'××” ×”××”×™×¨×•×ª ×”××•×ª×¨×ª ×‘×“×¨×š ×¢×™×¨×•× ×™×ª ×‘×”×¢×“×¨ ×ª××¨×•×¨?', options:['50 ×§×\'×©','60 ×§×\'×©','70 ×§×\'×©','80 ×§×\'×©'], correct:0},
      {id:2, topic:'×ª××¨×•×¨×™×', q:'××” ××©××¢×•×ª ×ª××¨×•×¨ 301 (×¢×¦×•×¨)?', options:['×”××˜ ×•×”×¢×‘×¨ ×–×›×•×ª','×¢×¦×•×¨ ×¢×¦×™×¨×” ××•×—×œ×˜×ª','×ª× ×•×¢×” ×—×“-×¡×˜×¨×™×ª','×–×”×™×¨×•×ª ×¡×›× ×”'], correct:1},
      {id:3, topic:'×–×›×•×™×•×ª ×§×“×™××”', q:'×‘×¦×•××ª ×‘×œ×ª×™ ××¨×•××–×¨, ×œ××™ ×–×›×•×ª ×§×“×™××”?', options:['×œ×¨×›×‘ ××™××™×Ÿ','×œ×¨×›×‘ ××©×××œ','×œ×¨×›×‘ ×”×’×“×•×œ','×œ××™ ×©××’×™×¢ ×¨××©×•×Ÿ'], correct:0},
      {id:4, topic:'×‘×˜×™×—×•×ª', q:'××ª×™ ×—×•×‘×” ×œ×”×“×œ×™×§ ××•×¨×•×ª ×‘×¨×›×‘ ××—×•×¥ ×œ×¢×™×¨?', options:['×ª××™×“','×‘×–××Ÿ ×’×©×/×¢×¨×¤×œ','×¨×§ ×‘×œ×™×œ×”','×¨×§ ×‘×›×‘×™×© ××”×™×¨'], correct:1},
      {id:5, topic:'×©×œ×˜×™×', q:'××” ××©××¢×•×ª ×ª××¨×•×¨ ×¢×’×•×œ ×›×—×•×œ ×¢× ×—×¥ ×™××™× ×”?', options:['××™×Ÿ ×›× ×™×¡×”','×¤× ×” ×™××™× ×” ×‘×œ×‘×“','×ª×Ÿ ×–×›×•×ª ×§×“×™××”','×“×¨×š ××”×™×¨×”'], correct:1},
      {id:6, topic:'× ×”×™×’×” ××•× ×¢×ª', q:'××”×• ××¨×—×§ ×‘×œ×™××”?', options:['××¨×—×§ ×¢×“ ×¢×¦×™×¨×” ×œ××—×¨ ×–×™×”×•×™ ×¡×›× ×”','×”××¨×—×§ ×‘×™×Ÿ ×¨×›×‘×™×','××¨×—×§ ×‘×˜×•×— ×œ×¢×§×™×¤×”','××™×Ÿ ×ª×©×•×‘×” × ×›×•× ×”'], correct:0},
      {id:7, topic:'×—× ×™×”', q:'×”×× ××•×ª×¨×ª ×—× ×™×” ×‘××§×•× ×”××¡×•××Ÿ ×‘××“×•×-×œ×‘×Ÿ?', options:['××•×ª×¨ ×ª××™×“','××¡×•×¨ ×‘×“×¨×š ×›×œ×œ','××•×ª×¨ ×¨×§ ×‘×œ×™×œ×”','××•×ª×¨ ×¨×§ ×œ××•×¤× ×•×¢×™×'], correct:1},
      {id:8, topic:'×¤× ×™×•×ª', q:'×‘×¢×ª ×¤× ×™×™×” ×™××™× ×”, ×”×™×›×Ÿ ×¢×œ ×”×¨×›×‘ ×œ×”×™×•×ª?', options:['×§×¨×•×‘ ×œ×§×• ×”×××¦×¢','×‘××¨×›×– ×”× ×ª×™×‘','×§×¨×•×‘ ×œ×©×¤×ª ×”×›×‘×™×© ×”×™×× ×™×ª','×‘×›×œ ××§×•×'], correct:2},
      {id:9, topic:'××¢×‘×¨×™ ×—×¦×™×”', q:'×›×™×¦×“ ×™×© ×œ× ×”×•×’ ×‘×§×¨×‘×ª ××¢×‘×¨ ×—×¦×™×”?', options:['×œ×”××™×¥ ×•×œ×¢×‘×•×¨ ××”×¨','×œ×”××˜ ×•×œ×”×™×•×ª ××•×›× ×™× ×œ×¢×¦×™×¨×”','×œ× ×œ×©× ×•×ª ××”×™×¨×•×ª','×œ×¢×¦×•×¨ ×ª××™×“'], correct:1},
      {id:10, topic:'×¡×™××•× ×™ ×“×¨×š', q:'×§×• ×§×˜×¢-×¨×¦×™×£ ×‘×¦×“×š: ××” ×”××©××¢×•×ª?', options:['××•×ª×¨ ×œ×¢×§×•×£','××¡×•×¨ ×œ×¢×§×•×£ ××¦×“ ×”×¨×¦×™×£','×—× ×™×” ××•×ª×¨×ª','× ×ª×™×‘ ×ª×—×‘×•×¨×” ×¦×™×‘×•×¨×™×ª'], correct:1},
      {id:11, topic:'×‘×˜×™×—×•×ª', q:'×”×™×›×Ÿ ×™×© ×œ×”×¡×ª×›×œ ×‘×–××Ÿ × ×”×™×’×”?', options:['×¨×§ ×¨×—×•×§ ×§×“×™××”','×¨×§ ×§×¨×•×‘ ×œ×¨×›×‘','×œ×©×œ×‘ ××‘×˜×™× ×§×¨×•×‘-×¨×—×•×§ ×•××¨××•×ª','×¨×§ ×¢×œ ×œ×•×— ×”××—×•×•× ×™×'], correct:2},
      {id:12, topic:'× ×”×™×’×” ×‘××–×’ ××•×•×™×¨', q:'××™×š × ×•×”×’×™× ×‘×¢×¨×¤×œ ×›×‘×“?', options:['××•×¨×•×ª ×’×‘×•×”×™× ×•×”××¦×”','××•×¨×•×ª ×“×¨×š/×¢×¨×¤×œ ×•×”××˜×”','×œ×œ× ××•×¨×•×ª','×œ×¢×¦×•×¨ ×‘×××¦×¢ ×”× ×ª×™×‘'], correct:1},
    ];

    const SIGNS = [
      {id:201, name:'×¢×¦×•×¨ (301)', desc:'×—×•×‘×” ×œ×¢×¦×•×¨ ×¢×¦×™×¨×” ××•×—×œ×˜×ª ×œ×¤× ×™ ×§×• ×¢×¦×™×¨×”/×¦×•××ª ×•×œ×”×¢× ×™×§ ×–×›×•×ª ×§×“×™××”.'},
      {id:202, name:'×ª×Ÿ ×–×›×•×ª ×§×“×™××” (302)', desc:'×”××˜/×™ ×•×”×¢× ×§/×™ ×–×›×•×ª ×§×“×™××” ×œ×ª× ×•×¢×” ×‘×“×¨×š ×”×—×•×¦×”.'},
      {id:203, name:'×¤× ×” ×™××™× ×” ×‘×œ×‘×“', desc:'×ª× ×•×¢×” ××•×ª×¨×ª ×™××™× ×” ×‘×œ×‘×“ â€“ ×—×•×‘×” ×œ×¦×™×™×ª ×œ×›×™×•×•×Ÿ.'},
      {id:204, name:'×¡×›× ×” ×›×œ×œ×™×ª', desc:'×”××˜/×™ ×•×©××•×¨/×™ ×¢×œ ×–×”×™×¨×•×ª â€“ ×¡×›× ×” ×©××™× ×” ××•×’×“×¨×ª.'},
      {id:205, name:'××™×Ÿ ×›× ×™×¡×”', desc:'××¡×•×¨×” ×›× ×™×¡×” ×œ×¨×›×‘ ×××•×œ â€“ ×—×“-×¡×˜×¨×™ ××”×›×™×•×•×Ÿ ×”× ×’×“×™.'}
    ];

    // ====== ××¦×‘ ××¤×œ×™×§×¦×™×” ======
    const state = {
      view: 'home',
      study: { currentIndex: 0, total: 5, queue: [] },
      exam: { running: false, index: 0, questions: [], answers: {}, review: new Set(), timer: null, secondsLeft: 0 },
      stats: loadStats()
    };

    // ====== LocalStorage ======
    function loadStats(){
      try{ const raw = localStorage.getItem('theoryStats'); if(raw){ return JSON.parse(raw); } }catch(e){}
      return { totalAnswered:0, correct:0, streak:0, lastPracticeDate:null, topics:{} };
    }
    function saveStats(){ try{ localStorage.setItem('theoryStats', JSON.stringify(state.stats)); }catch(e){} }
    function updateStreakOnPractice(){
      const today = new Date();
      const d = today.toISOString().slice(0,10);
      if(state.stats.lastPracticeDate === d){ return; }
      if(state.stats.lastPracticeDate){
        const prev = new Date(state.stats.lastPracticeDate);
        const diff = Math.round((today - prev)/(1000*60*60*24));
        state.stats.streak = (diff === 1) ? (state.stats.streak + 1) : 1;
      } else { state.stats.streak = 1; }
      state.stats.lastPracticeDate = d; saveStats();
    }

    // ====== × ×™×•×•×˜ ======
    function navigate(view){
      state.view = view;
      document.querySelectorAll('.view').forEach(v=>v.classList.add('hidden'));
      document.getElementById('view-'+view).classList.remove('hidden');
      document.querySelectorAll('.tab-btn').forEach(btn=>{
        if(btn.dataset.view===view){
          btn.classList.remove('bg-white','border','border-slate-200');
          btn.classList.add('bg-slate-900','text-white');
        } else {
          btn.classList.add('bg-white','border','border-slate-200');
          btn.classList.remove('bg-slate-900','text-white');
        }
      });
      document.body.classList.toggle('focus-mode', view==='study');
      refreshDashboard();
      if(view==='study'){ startDailyStudy(); }
    }

    // ====== ×˜×•×¡×˜×¨ ======
    function toast(msg){
      const el = document.getElementById('toast');
      el.innerHTML = `<div class="px-4 py-2 rounded-xl shadow bg-gradient-to-r from-yellow-300 to-amber-400 text-slate-900">${msg}</div>`;
      el.classList.remove('hidden');
      setTimeout(()=> el.classList.add('hidden'), 1800);
    }

    // ====== ×“×©×‘×•×¨×“ ======
    function accuracyPercent(){ const a = state.stats.totalAnswered||0, c = state.stats.correct||0; return a ? Math.round((c/a)*100) : 0; }
    function refreshDashboard(){
      const acc = accuracyPercent();
      const set = (id,val)=>{ const el=document.getElementById(id); if(el) el.textContent=val; };
      set('stat-correct-rate', acc+'%');
      set('stat-answered', state.stats.totalAnswered);
      set('stat-streak', (state.stats.streak||0)+'ğŸ”¥');
      set('pf-accuracy', acc+'%');
      set('pf-answered', state.stats.totalAnswered);
      set('pf-streak', (state.stats.streak||0)+'ğŸ”¥');
      // topic stats
      const wrap = document.getElementById('topic-stats'); if(!wrap) return; wrap.innerHTML='';
      const topics = state.stats.topics || {}; const names = Object.keys(topics);
      if(!names.length){ wrap.innerHTML = '<div class="text-slate-500">××™×Ÿ ×¢×“×™×™×Ÿ × ×ª×•× ×™× ×œ×¤×™ × ×•×©×.</div>'; return; }
      names.forEach(name=>{
        const t = topics[name]; const pct = t.total ? Math.round((t.correct/t.total)*100) : 0;
        const row = document.createElement('div'); row.className = 'flex items-center gap-3';
        row.innerHTML = `<div class="w-28 text-sm text-slate-600">${name}</div>
          <div class="flex-1 h-2 bg-slate-200 rounded-full overflow-hidden"><div class="h-full" style="background: linear-gradient(135deg, #8B5FBF 0%, #6A4C93 50%, #7B68EE 100%); width:${pct}%"></div></div>
          <div class="w-10 text-end text-sm">${pct}%</div>`; wrap.appendChild(row);
      });
    }

    function recordAnswer(topic, correct){
      state.stats.totalAnswered += 1; if(correct) state.stats.correct += 1;
      state.stats.topics[topic] = state.stats.topics[topic] || {correct:0,total:0};
      state.stats.topics[topic].total += 1; if(correct) state.stats.topics[topic].correct += 1; saveStats();
    }

    // ====== ×œ××™×“×” ×™×•××™×ª (Focus Mode) ======
    function startDailyStudy(){
      state.study.currentIndex = 0;
      const pool = [...QUESTIONS]; const picked = [];
      while(picked.length < Math.min(5, pool.length)){ const i = Math.floor(Math.random()*pool.length); picked.push(pool.splice(i,1)[0]); }
      state.study.queue = picked; updateStreakOnPractice(); renderStudyCard(); updateStudyProgress();
    }
    function updateStudyProgress(){ const pct = Math.round((state.study.currentIndex/state.study.queue.length)*100); const bar=document.getElementById('study-progress'); if(bar) bar.style.width = pct + '%'; }
    function renderStudyCard(){
      const box = document.getElementById('study-card'); if(!box) return; box.innerHTML = '';
      const i = state.study.currentIndex; if(i >= state.study.queue.length){
        box.innerHTML = `<div class="text-center space-y-3">
          <div class="text-xl font-semibold">×›×œ ×”×›×‘×•×“! ×¡×™×™××ª ××ª ×”×œ××™×“×” ×”×™×•××™×ª ğŸ‰</div>
          <button class="px-4 py-2 rounded-2xl btn-primary" onclick="navigate('home')">×—×–×¨×” ×œ×‘×™×ª</button>
        </div>`; const bar = document.getElementById('study-progress'); if(bar) bar.style.width='100%'; return; }
      const q = state.study.queue[i];
      const qEl = document.createElement('div'); qEl.className = 'reveal in-view';
      qEl.innerHTML = `<div class=\"text-slate-600 text-sm mb-1\">× ×•×©×: ${q.topic}</div><div class=\"text-lg font-medium\">${q.q}</div>`; box.appendChild(qEl);
      const opts = document.createElement('div'); opts.id='study-options'; opts.className = 'mt-3 grid gap-2';
      q.options.forEach((txt,idx)=>{ const b = document.createElement('button'); b.className='px-3 py-2 rounded-xl border text-right hover:bg-slate-50 transition'; b.textContent=txt; b.dataset.idx=idx; b.onclick=()=>handleStudyAnswer(idx,q,opts,box); opts.appendChild(b); });
      box.appendChild(opts);
    }
    function handleStudyAnswer(idx,q,opts,box){
      const isCorrect = idx===q.correct; recordAnswer(q.topic, isCorrect);
      opts.querySelectorAll('button').forEach(x=>x.disabled=true);
      const chosen = [...opts.children].find(b=>Number(b.dataset.idx)===idx); if(chosen){ chosen.classList.remove('border'); chosen.classList.add(isCorrect?'bg-green-100':'bg-red-100'); }
      const exp = document.createElement('div'); exp.className='text-sm text-slate-600'; exp.textContent = isCorrect? '× ×›×•×Ÿ! ×××©×™×›×™× ×œ×©××œ×” ×”×‘××”.' : '×œ× × ×•×¨×, × ×œ××“ ××–×” ×‘×©××œ×” ×”×‘××”.'; box.appendChild(exp);
      setTimeout(()=>{ state.study.currentIndex++; updateStudyProgress(); renderStudyCard(); }, 550);
    }

    // ====== ××‘×—×Ÿ ××“×•××” ======
    function startExam(){
      state.exam.running = true; state.exam.index = 0; state.exam.answers = {}; state.exam.review.clear();
      const arr = []; for(let i=0;i<30;i++){ arr.push( QUESTIONS[Math.floor(Math.random()*QUESTIONS.length)] ); }
      state.exam.questions = arr; document.getElementById('exam-total').textContent = arr.length;
      document.getElementById('exam-area').classList.remove('hidden'); document.getElementById('exam-result').classList.add('hidden'); document.getElementById('btn-start-exam').disabled = true;
      state.exam.secondsLeft = 20*60; updateExamTimer(); state.exam.timer = setInterval(()=>{ state.exam.secondsLeft--; updateExamTimer(); if(state.exam.secondsLeft<=0){ submitExam(); } }, 1000);
      renderExamQuestion(); renderExamMap();
    }
    function updateExamTimer(){ const m = Math.floor(state.exam.secondsLeft/60); const s = state.exam.secondsLeft%60; document.getElementById('exam-timer').textContent = `${m}:${String(s).padStart(2,'0')}`; }
    function renderExamQuestion(){ const q = state.exam.questions[state.exam.index]; document.getElementById('exam-index').textContent = (state.exam.index+1); document.getElementById('exam-question').textContent = q.q; const opts = document.getElementById('exam-options'); opts.innerHTML=''; q.options.forEach((txt,idx)=>{ const lbl=document.createElement('label'); lbl.className='flex items-center gap-2 p-2 rounded-xl border hover:bg-slate-50 cursor-pointer transition'; const inp=document.createElement('input'); inp.type='radio'; inp.name='exam-opt'; inp.checked = state.exam.answers[q.id]===idx; inp.onchange = ()=>{ state.exam.answers[q.id]=idx; renderExamMap(); }; const span=document.createElement('span'); span.textContent=txt; lbl.appendChild(inp); lbl.appendChild(span); opts.appendChild(lbl); }); document.getElementById('exam-prev').disabled = state.exam.index===0; document.getElementById('exam-next').disabled = state.exam.index===(state.exam.questions.length-1); updateMarkButton(); }
    function updateMarkButton(){ const q = state.exam.questions[state.exam.index]; const marked = state.exam.review.has(q.id); const btn = document.getElementById('exam-mark'); btn.textContent = marked? '×”×¡×¨ ×¡×™××•×Ÿ' : '×¡××Ÿ ×œ×‘×“×™×§×”'; }
    function toggleMark(){ const q = state.exam.questions[state.exam.index]; if(state.exam.review.has(q.id)) state.exam.review.delete(q.id); else state.exam.review.add(q.id); updateMarkButton(); renderExamMap(); }
    function renderExamMap(){ const wrap = document.getElementById('exam-map'); wrap.innerHTML=''; state.exam.questions.forEach((q,i)=>{ const ansIdx = state.exam.answers[q.id]; const marked = state.exam.review.has(q.id); const b = document.createElement('button'); b.className = 'h-8 text-xs rounded-lg border flex items-center justify-center'; b.title = `×©××œ×” ${i+1}`; b.setAttribute('aria-label', `×©××œ×” ${i+1}${marked? ', ××¡×•××Ÿ ×œ×‘×“×™×§×”':''}${ansIdx!=null? ', × ×¢× ×ª×”':''}`);
        if(i===state.exam.index){ b.classList.add('border-slate-900'); }
        if(marked){ b.classList.add('bg-amber-100','border-amber-300'); }
        else if(ansIdx!=null){ b.classList.add('bg-slate-100'); }
        b.textContent = i+1; b.onclick = ()=>{ state.exam.index = i; renderExamQuestion(); renderExamMap(); }; wrap.appendChild(b); }); }
    function submitExam(){ if(state.exam.timer){ clearInterval(state.exam.timer); state.exam.timer=null; } let correct=0; state.exam.questions.forEach(q=>{ const ans = state.exam.answers[q.id]; const ok = (ans===q.correct); if(ok){ correct++; } recordAnswer(q.topic, !!ok); }); const total = state.exam.questions.length; const percent = Math.round((correct/total)*100); const pass = percent >= 80; const box = document.getElementById('exam-result'); box.classList.remove('hidden'); document.getElementById('exam-area').classList.add('hidden'); document.getElementById('btn-start-exam').disabled = false; box.innerHTML = `<div class="p-4 rounded-2xl border ${pass?'bg-green-50':'bg-red-50'}">
        <div class="text-lg font-semibold mb-1">×ª×•×¦××”: ${correct}/${total} (${percent}%)</div>
        <div class="text-slate-700 mb-3">${pass? '××¢×•×œ×”! × ×¨××” ×©××ª×”/××ª ×‘×›×™×•×•×Ÿ ×”× ×›×•×Ÿ âœ…' : '×™×© ×¢×•×“ ××” ×œ×©×¤×¨ â€“ × ×¢×‘×•×“ ×××•×§×“ ×¢×œ × ×§×•×“×•×ª ×”×—×•×œ×©×”.'}</div>
        <button class="px-4 py-2 rounded-2xl btn-secondary" onclick="startExam()">× ×¡×”/×™ ×©×•×‘</button>
      </div>`; refreshDashboard(); toast('×”××‘×—×Ÿ ×”×¡×ª×™×™× â€“ ×”×ª×•×¦××” × ×©××¨×”'); }

    // ====== ×›×¨×˜×™×¡×™×•×ª ×ª××¨×•×¨×™× ======
    const flash = { order: [], index: 0, queue: [] };
    function startSigns(){ flash.order = [...SIGNS]; flash.index = 0; flash.queue = []; renderSignCard(); }
    function renderSignCard(){ const box = document.getElementById('sign-card'); box.innerHTML = ''; if(flash.index >= flash.order.length){ if(flash.queue.length){ flash.order = [...flash.queue]; flash.queue = []; flash.index = 0; } else { box.innerHTML = `<div class="text-center space-y-2"><div class="text-xl font-semibold">×™×¤×”! ×©×œ×˜×ª× ×‘×ª××¨×•×¨×™× ×©×‘×¡×˜ ×–×” ğŸ‰</div><button class="px-4 py-2 rounded-2xl btn-secondary" onclick="startSigns()">×¡×™×‘×•×‘ × ×•×¡×£</button></div>`; return; } }
      const s = flash.order[flash.index]; const card = document.createElement('div'); card.className='p-4 rounded-2xl border bg-slate-50 reveal in-view'; card.innerHTML = `<div class="text-4xl mb-2">ğŸš§</div><div class="text-lg font-semibold">${s.name}</div><div class="text-slate-700">${s.desc}</div>`; box.appendChild(card);
      const actions = document.createElement('div'); actions.className='flex gap-2 mt-3'; const known=document.createElement('button'); known.className='px-3 py-1.5 rounded-xl border'; known.textContent='×–×›×•×¨ ×œ×™'; const unknown=document.createElement('button'); unknown.className='px-3 py-1.5 rounded-xl btn-primary'; unknown.textContent='×œ× ×–×›×•×¨'; known.onclick=()=>{ flash.index++; renderSignCard(); }; unknown.onclick=()=>{ flash.queue.push(s); flash.index++; renderSignCard(); }; actions.appendChild(known); actions.appendChild(unknown); box.appendChild(actions); }

    // ====== Theme Toggle ======
    const themeBtn = document.getElementById('btn-theme');
    function applyTheme(){ const dark = localStorage.getItem('themeDark')==='1'; document.documentElement.classList.toggle('dark', dark); document.body.classList.toggle('bg-slate-900', dark); document.body.classList.toggle('text-slate-100', dark); themeBtn.textContent = dark? '××¦×‘ ×›×”×”' : '××¦×‘ ×‘×”×™×¨'; }

    // ====== Reveal-on-scroll ======
    function setupReveal(){ const observer = new IntersectionObserver((entries)=>{ entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('in-view'); observer.unobserve(e.target); } }) }, { threshold: 0.14 }); document.querySelectorAll('.reveal').forEach(el=> observer.observe(el)); }

    // ====== ×§×™×¦×•×¨×™ ××§×œ×“×ª ======
    function onKey(e){
      const key = e.key.toLowerCase();
      // ×‘×œ××™×“×”
      if(state.view==='study'){
        const opts = document.getElementById('study-options');
        if(['1','2','3','4'].includes(key) && opts){ const i = Number(key)-1; const btn = opts.children[i]; if(btn){ btn.click(); }}
        if(key==='n'){ // ××™×Ÿ "×”×‘×" ×× ×œ× ×¢× ×™× ×•; ×××¤×©×¨ ×“×™×œ×•×’
          document.getElementById('study-skip')?.click();
        }
        if(key==='k'){ document.getElementById('study-skip')?.click(); }
      }
      // ×‘××‘×—×Ÿ
      if(state.view==='exam' && state.exam.running){
        if(['1','2','3','4'].includes(key)){
          const idx = Number(key)-1; const q = state.exam.questions[state.exam.index]; if(q){ state.exam.answers[q.id]=idx; renderExamQuestion(); renderExamMap(); }
        }
        if(key==='n'){ if(state.exam.index < state.exam.questions.length-1){ state.exam.index++; renderExamQuestion(); renderExamMap(); }}
        if(key==='p'){ if(state.exam.index>0){ state.exam.index--; renderExamQuestion(); renderExamMap(); }}
        if(key==='m'){ toggleMark(); }
        if(key==='s'){ submitExam(); }
      }
    }

    // ====== ×—×™×‘×•×¨ ××™×¨×•×¢×™× ======
    function wire(){
      // ×”×™×¨×•
      document.getElementById('hero-start-study').addEventListener('click', ()=>{ navigate('study'); toast('××ª×—×™×œ×™× ×‘×œ××™×“×” ×™×•××™×ª'); });
      document.getElementById('hero-start-exam').addEventListener('click', ()=>{ navigate('exam'); startExam(); });
      // ×˜××‘×™×
      document.querySelectorAll('.tab-btn').forEach(b=> b.addEventListener('click', ()=> navigate(b.dataset.view)));
      document.getElementById('cta-start-daily').addEventListener('click', ()=>{ navigate('study'); toast('×˜×•×‘, ××ª×—×™×œ×™× ×‘×œ××™×“×” ×™×•××™×ª!'); });
      document.getElementById('cta-start-exam').addEventListener('click', ()=>{ navigate('exam'); startExam(); });
      // ×œ××™×“×”
      document.getElementById('study-skip').addEventListener('click', ()=>{ state.study.currentIndex++; updateStudyProgress(); renderStudyCard(); });
      document.getElementById('study-exit').addEventListener('click', ()=> navigate('home'));
      // ××‘×—×Ÿ
      document.getElementById('btn-start-exam').addEventListener('click', startExam);
      document.getElementById('exam-prev').addEventListener('click', ()=>{ if(state.exam.index>0){ state.exam.index--; renderExamQuestion(); renderExamMap(); }});
      document.getElementById('exam-next').addEventListener('click', ()=>{ if(state.exam.index < state.exam.questions.length-1){ state.exam.index++; renderExamQuestion(); renderExamMap(); }});
      document.getElementById('exam-submit').addEventListener('click', submitExam);
      document.getElementById('exam-cancel').addEventListener('click', ()=>{ if(state.exam.timer){ clearInterval(state.exam.timer); state.exam.timer=null; } document.getElementById('exam-area').classList.add('hidden'); document.getElementById('btn-start-exam').disabled=false; document.getElementById('exam-result').classList.add('hidden'); state.exam.running=false; });
      document.getElementById('exam-mark').addEventListener('click', toggleMark);
      // ×ª××¨×•×¨×™×
      document.querySelector('[data-view="signs"]').addEventListener('click', startSigns);
      // Theme
      const themeBtn = document.getElementById('btn-theme'); themeBtn.addEventListener('click', ()=>{ const v = localStorage.getItem('themeDark')==='1'; localStorage.setItem('themeDark', v?'0':'1'); applyTheme(); });
      // Keyboard
      document.addEventListener('keydown', onKey);
    }

    // ====== ××ª×—×•×œ ======
    function init(){ applyTheme(); wire(); setupReveal(); navigate('home'); }
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
